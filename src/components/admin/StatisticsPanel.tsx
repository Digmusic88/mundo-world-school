import React, { useState, useMemo } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Tabs,
  TabsContent,
  TabsList,
  TabsTrigger,
} from '@/components/ui/tabs';
import { Progress } from '@/components/ui/progress';
import { 
  Users, 
  GraduationCap,
  BookOpen,
  TrendingUp,
  TrendingDown,
  Calendar,
  DollarSign,
  Award,
  Clock,
  UserCheck,
  UserX,
  Target,
  BarChart3,
  PieChart,
  Activity,
  AlertTriangle,
  CheckCircle,
  FileText,
  MessageSquare
} from 'lucide-react';
import { useUsers, useGroups, useGrades, useAttendance, useFinances, useActivities, useMessages } from '@/hooks/useData';

const StatisticsPanel: React.FC = () => {
  const { users } = useUsers();
  const { groups } = useGroups();
  const { grades } = useGrades();
  const { attendance } = useAttendance();
  const { finances } = useFinances();
  const { activities } = useActivities();
  const { messages } = useMessages();
  const [selectedPeriod, setSelectedPeriod] = useState('current');
  const [selectedMetric, setSelectedMetric] = useState('overview');

  // Calcular estadísticas generales
  const generalStats = useMemo(() => {
    const totalUsers = users.length;
    const students = users.filter(u => u.role === 'student');
    const teachers = users.filter(u => u.role === 'teacher');
    const parents = users.filter(u => u.role === 'parent');
    const admins = users.filter(u => u.role === 'admin');

    return {
      totalUsers,
      students: students.length,
      teachers: teachers.length,
      parents: parents.length,
      admins: admins.length,
      totalGroups: groups.length,
      activeGroups: groups.filter(g => g.active).length
    };
  }, [users, groups]);

  // Calcular estadísticas académicas
  const academicStats = useMemo(() => {
    const totalGrades = grades.length;
    const averageGrade = grades.reduce((sum, g) => sum + g.points, 0) / totalGrades;
    
    // Distribución por rangos
    const excellent = grades.filter(g => g.points >= 90).length;
    const good = grades.filter(g => g.points >= 80 && g.points < 90).length;
    const satisfactory = grades.filter(g => g.points >= 70 && g.points < 80).length;
    const needsImprovement = grades.filter(g => g.points < 70).length;

    // Estadísticas por materia
    const subjectStats = grades.reduce((acc, grade) => {\n      if (!acc[grade.subject]) {\n        acc[grade.subject] = { total: 0, sum: 0, count: 0 };\n      }\n      acc[grade.subject].sum += grade.points;\n      acc[grade.subject].count += 1;\n      acc[grade.subject].total = acc[grade.subject].sum / acc[grade.subject].count;\n      return acc;\n    }, {} as Record<string, { total: number; sum: number; count: number }>);\n\n    return {\n      totalGrades,\n      averageGrade: Math.round(averageGrade * 10) / 10,\n      distribution: {\n        excellent,\n        good,\n        satisfactory,\n        needsImprovement\n      },\n      subjectAverages: Object.entries(subjectStats).map(([subject, stats]) => ({\n        subject,\n        average: Math.round(stats.total * 10) / 10,\n        count: stats.count\n      })).sort((a, b) => b.average - a.average)\n    };\n  }, [grades]);\n\n  // Calcular estadísticas de asistencia\n  const attendanceStats = useMemo(() => {\n    const totalRecords = attendance.length;\n    const presentRecords = attendance.filter(a => a.status === 'present').length;\n    const absentRecords = attendance.filter(a => a.status === 'absent').length;\n    const lateRecords = attendance.filter(a => a.status === 'late').length;\n    const excusedRecords = attendance.filter(a => a.status === 'excused').length;\n    \n    const attendanceRate = totalRecords > 0 ? (presentRecords / totalRecords) * 100 : 0;\n    \n    // Asistencia por estudiante\n    const studentAttendance = attendance.reduce((acc, record) => {\n      if (!acc[record.student_id]) {\n        acc[record.student_id] = { present: 0, total: 0, rate: 0 };\n      }\n      acc[record.student_id].total += 1;\n      if (record.status === 'present') {\n        acc[record.student_id].present += 1;\n      }\n      acc[record.student_id].rate = (acc[record.student_id].present / acc[record.student_id].total) * 100;\n      return acc;\n    }, {} as Record<string, { present: number; total: number; rate: number }>);\n\n    const studentsWithPoorAttendance = Object.entries(studentAttendance)\n      .filter(([_, stats]) => stats.rate < 85).length;\n\n    return {\n      totalRecords,\n      presentRecords,\n      absentRecords,\n      lateRecords,\n      excusedRecords,\n      attendanceRate: Math.round(attendanceRate * 10) / 10,\n      studentsWithPoorAttendance\n    };\n  }, [attendance]);\n\n  // Calcular estadísticas financieras\n  const financialStats = useMemo(() => {\n    const totalAmount = finances.reduce((sum, f) => sum + f.amount, 0);\n    const paidAmount = finances.filter(f => f.status === 'paid').reduce((sum, f) => sum + f.amount, 0);\n    const pendingAmount = finances.filter(f => f.status === 'pending').reduce((sum, f) => sum + f.amount, 0);\n    const overdueAmount = finances.filter(f => f.status === 'overdue').reduce((sum, f) => sum + f.amount, 0);\n    \n    const collectionRate = totalAmount > 0 ? (paidAmount / totalAmount) * 100 : 0;\n    \n    return {\n      totalAmount,\n      paidAmount,\n      pendingAmount,\n      overdueAmount,\n      collectionRate: Math.round(collectionRate * 10) / 10,\n      totalTransactions: finances.length,\n      paidTransactions: finances.filter(f => f.status === 'paid').length,\n      pendingTransactions: finances.filter(f => f.status === 'pending').length,\n      overdueTransactions: finances.filter(f => f.status === 'overdue').length\n    };\n  }, [finances]);\n\n  // Calcular estadísticas de actividades\n  const activityStats = useMemo(() => {\n    const totalActivities = activities.length;\n    const activeActivities = activities.filter(a => a.status === 'active').length;\n    const completedActivities = activities.filter(a => a.status === 'completed').length;\n    const overdueActivities = activities.filter(a => {\n      const dueDate = new Date(a.due_date);\n      const today = new Date();\n      return dueDate < today && a.status === 'active';\n    }).length;\n\n    // Estadísticas por tipo\n    const typeStats = activities.reduce((acc, activity) => {\n      if (!acc[activity.type]) {\n        acc[activity.type] = 0;\n      }\n      acc[activity.type] += 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    return {\n      totalActivities,\n      activeActivities,\n      completedActivities,\n      overdueActivities,\n      completionRate: totalActivities > 0 ? (completedActivities / totalActivities) * 100 : 0,\n      typeDistribution: Object.entries(typeStats).map(([type, count]) => ({ type, count }))\n    };\n  }, [activities]);\n\n  // Calcular estadísticas de comunicación\n  const communicationStats = useMemo(() => {\n    const totalMessages = messages.length;\n    const readMessages = messages.filter(m => m.read).length;\n    const unreadMessages = messages.filter(m => !m.read).length;\n    const highPriorityMessages = messages.filter(m => m.priority === 'high').length;\n    \n    return {\n      totalMessages,\n      readMessages,\n      unreadMessages,\n      highPriorityMessages,\n      readRate: totalMessages > 0 ? (readMessages / totalMessages) * 100 : 0\n    };\n  }, [messages]);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900\">Panel de Estadísticas</h2>\n          <p className=\"text-gray-600\">Métricas y análisis del centro educativo</p>\n        </div>\n        <div className=\"flex space-x-4\">\n          <Select value={selectedPeriod} onValueChange={setSelectedPeriod}>\n            <SelectTrigger className=\"w-48\">\n              <SelectValue placeholder=\"Período\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"current\">Período Actual</SelectItem>\n              <SelectItem value=\"semester\">Este Semestre</SelectItem>\n              <SelectItem value=\"year\">Este Año</SelectItem>\n              <SelectItem value=\"all\">Histórico</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      {/* Métricas principales */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">Total Usuarios</p>\n                <p className=\"text-3xl font-bold text-blue-600\">{generalStats.totalUsers}</p>\n                <p className=\"text-xs text-gray-500\">+12% vs mes anterior</p>\n              </div>\n              <Users className=\"h-8 w-8 text-blue-600\" />\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">Promedio General</p>\n                <p className=\"text-3xl font-bold text-green-600\">{academicStats.averageGrade}</p>\n                <p className=\"text-xs text-gray-500\">+3.2% vs período anterior</p>\n              </div>\n              <Award className=\"h-8 w-8 text-green-600\" />\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">Asistencia</p>\n                <p className=\"text-3xl font-bold text-purple-600\">{attendanceStats.attendanceRate}%</p>\n                <p className=\"text-xs text-gray-500\">-1.5% vs mes anterior</p>\n              </div>\n              <UserCheck className=\"h-8 w-8 text-purple-600\" />\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">Recaudación</p>\n                <p className=\"text-3xl font-bold text-orange-600\">{financialStats.collectionRate}%</p>\n                <p className=\"text-xs text-gray-500\">+5.8% vs mes anterior</p>\n              </div>\n              <DollarSign className=\"h-8 w-8 text-orange-600\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Tabs de estadísticas detalladas */}\n      <Tabs value={selectedMetric} onValueChange={setSelectedMetric}>\n        <TabsList className=\"grid w-full grid-cols-6\">\n          <TabsTrigger value=\"overview\">General</TabsTrigger>\n          <TabsTrigger value=\"academic\">Académico</TabsTrigger>\n          <TabsTrigger value=\"attendance\">Asistencia</TabsTrigger>\n          <TabsTrigger value=\"financial\">Financiero</TabsTrigger>\n          <TabsTrigger value=\"activities\">Actividades</TabsTrigger>\n          <TabsTrigger value=\"communication\">Comunicación</TabsTrigger>\n        </TabsList>\n\n        {/* Vista General */}\n        <TabsContent value=\"overview\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg flex items-center\">\n                  <Users className=\"mr-2 h-5 w-5\" />\n                  Distribución de Usuarios\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm\">Estudiantes</span>\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"w-16 h-2 bg-gray-200 rounded\">\n                        <div className=\"h-full bg-blue-600 rounded\" style={{width: `${(generalStats.students/generalStats.totalUsers)*100}%`}}></div>\n                      </div>\n                      <span className=\"text-sm font-medium\">{generalStats.students}</span>\n                    </div>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm\">Profesores</span>\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"w-16 h-2 bg-gray-200 rounded\">\n                        <div className=\"h-full bg-green-600 rounded\" style={{width: `${(generalStats.teachers/generalStats.totalUsers)*100}%`}}></div>\n                      </div>\n                      <span className=\"text-sm font-medium\">{generalStats.teachers}</span>\n                    </div>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm\">Padres</span>\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"w-16 h-2 bg-gray-200 rounded\">\n                        <div className=\"h-full bg-purple-600 rounded\" style={{width: `${(generalStats.parents/generalStats.totalUsers)*100}%`}}></div>\n                      </div>\n                      <span className=\"text-sm font-medium\">{generalStats.parents}</span>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg flex items-center\">\n                  <BarChart3 className=\"mr-2 h-5 w-5\" />\n                  Rendimiento Académico\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm\">Excelente (90+)</span>\n                    <span className=\"text-sm font-medium\">{academicStats.distribution.excellent}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm\">Bueno (80-89)</span>\n                    <span className=\"text-sm font-medium\">{academicStats.distribution.good}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm\">Satisfactorio (70-79)</span>\n                    <span className=\"text-sm font-medium\">{academicStats.distribution.satisfactory}</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm\">Necesita mejora (<70)</span>\n                    <span className=\"text-sm font-medium\">{academicStats.distribution.needsImprovement}</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg flex items-center\">\n                  <Activity className=\"mr-2 h-5 w-5\" />\n                  Estado del Sistema\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm\">Grupos Activos</span>\n                    <Badge variant=\"outline\">{generalStats.activeGroups}/{generalStats.totalGroups}</Badge>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm\">Actividades Completadas</span>\n                    <Badge variant=\"outline\">{activityStats.completedActivities}/{activityStats.totalActivities}</Badge>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm\">Mensajes No Leídos</span>\n                    <Badge variant=\"outline\">{communicationStats.unreadMessages}</Badge>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm\">Asistencia Baja</span>\n                    <Badge variant=\"outline\">{attendanceStats.studentsWithPoorAttendance} estudiantes</Badge>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Vista Académica */}\n        <TabsContent value=\"academic\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Promedio por Materia</CardTitle>\n                <CardDescription>Rendimiento académico por asignatura</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  {academicStats.subjectAverages.map((subject) => (\n                    <div key={subject.subject} className=\"space-y-2\">\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-sm font-medium\">{subject.subject}</span>\n                        <span className=\"text-sm text-gray-600\">{subject.average}/100</span>\n                      </div>\n                      <Progress value={subject.average} className=\"h-2\" />\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Distribución de Calificaciones</CardTitle>\n                <CardDescription>Análisis del rendimiento estudiantil</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"text-center p-4 bg-green-50 rounded-lg\">\n                      <div className=\"text-2xl font-bold text-green-600\">{academicStats.distribution.excellent}</div>\n                      <div className=\"text-sm text-green-700\">Excelente</div>\n                      <div className=\"text-xs text-gray-600\">90-100 puntos</div>\n                    </div>\n                    <div className=\"text-center p-4 bg-blue-50 rounded-lg\">\n                      <div className=\"text-2xl font-bold text-blue-600\">{academicStats.distribution.good}</div>\n                      <div className=\"text-sm text-blue-700\">Bueno</div>\n                      <div className=\"text-xs text-gray-600\">80-89 puntos</div>\n                    </div>\n                    <div className=\"text-center p-4 bg-yellow-50 rounded-lg\">\n                      <div className=\"text-2xl font-bold text-yellow-600\">{academicStats.distribution.satisfactory}</div>\n                      <div className=\"text-sm text-yellow-700\">Satisfactorio</div>\n                      <div className=\"text-xs text-gray-600\">70-79 puntos</div>\n                    </div>\n                    <div className=\"text-center p-4 bg-red-50 rounded-lg\">\n                      <div className=\"text-2xl font-bold text-red-600\">{academicStats.distribution.needsImprovement}</div>\n                      <div className=\"text-sm text-red-700\">Necesita Mejora</div>\n                      <div className=\"text-xs text-gray-600\">< 70 puntos</div>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Vista de Asistencia */}\n        <TabsContent value=\"attendance\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Resumen de Asistencia</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"text-center\">\n                    <div className=\"text-3xl font-bold text-green-600\">{attendanceStats.attendanceRate}%</div>\n                    <div className=\"text-sm text-gray-600\">Tasa de Asistencia</div>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-sm\">Presentes</span>\n                      <span className=\"text-sm font-medium\">{attendanceStats.presentRecords}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-sm\">Ausentes</span>\n                      <span className=\"text-sm font-medium\">{attendanceStats.absentRecords}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-sm\">Tardanzas</span>\n                      <span className=\"text-sm font-medium\">{attendanceStats.lateRecords}</span>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Alertas de Asistencia</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center space-x-2\">\n                    <AlertTriangle className=\"h-5 w-5 text-red-500\" />\n                    <span className=\"text-sm\">{attendanceStats.studentsWithPoorAttendance} estudiantes con asistencia baja</span>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <Clock className=\"h-5 w-5 text-yellow-500\" />\n                    <span className=\"text-sm\">{attendanceStats.lateRecords} tardanzas este período</span>\n                  </div>\n                  <div className=\"flex items-center space-x-2\">\n                    <CheckCircle className=\"h-5 w-5 text-green-500\" />\n                    <span className=\"text-sm\">Meta de 95% de asistencia</span>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Tendencia Mensual</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm\">Enero</span>\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"w-16 h-2 bg-gray-200 rounded\">\n                        <div className=\"h-full bg-green-600 rounded\" style={{width: '95%'}}></div>\n                      </div>\n                      <span className=\"text-sm\">95%</span>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm\">Febrero</span>\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"w-16 h-2 bg-gray-200 rounded\">\n                        <div className=\"h-full bg-green-600 rounded\" style={{width: '92%'}}></div>\n                      </div>\n                      <span className=\"text-sm\">92%</span>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm\">Marzo</span>\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"w-16 h-2 bg-gray-200 rounded\">\n                        <div className=\"h-full bg-yellow-600 rounded\" style={{width: '88%'}}></div>\n                      </div>\n                      <span className=\"text-sm\">88%</span>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Vista Financiera */}\n        <TabsContent value=\"financial\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"text-center\">\n                  <DollarSign className=\"h-8 w-8 text-green-600 mx-auto mb-2\" />\n                  <div className=\"text-2xl font-bold text-green-600\">€{financialStats.paidAmount}</div>\n                  <div className=\"text-sm text-gray-600\">Recaudado</div>\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"text-center\">\n                  <Clock className=\"h-8 w-8 text-yellow-600 mx-auto mb-2\" />\n                  <div className=\"text-2xl font-bold text-yellow-600\">€{financialStats.pendingAmount}</div>\n                  <div className=\"text-sm text-gray-600\">Pendiente</div>\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"text-center\">\n                  <AlertTriangle className=\"h-8 w-8 text-red-600 mx-auto mb-2\" />\n                  <div className=\"text-2xl font-bold text-red-600\">€{financialStats.overdueAmount}</div>\n                  <div className=\"text-sm text-gray-600\">Vencido</div>\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"text-center\">\n                  <Target className=\"h-8 w-8 text-blue-600 mx-auto mb-2\" />\n                  <div className=\"text-2xl font-bold text-blue-600\">{financialStats.collectionRate}%</div>\n                  <div className=\"text-sm text-gray-600\">Tasa de Recaudación</div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Vista de Actividades */}\n        <TabsContent value=\"activities\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Estado de Actividades</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"text-center\">\n                    <div className=\"text-3xl font-bold text-blue-600\">{activityStats.completionRate.toFixed(1)}%</div>\n                    <div className=\"text-sm text-gray-600\">Tasa de Completitud</div>\n                  </div>\n                  <div className=\"grid grid-cols-3 gap-4 text-center\">\n                    <div className=\"p-3 bg-green-50 rounded\">\n                      <div className=\"text-xl font-bold text-green-600\">{activityStats.completedActivities}</div>\n                      <div className=\"text-xs text-gray-600\">Completadas</div>\n                    </div>\n                    <div className=\"p-3 bg-blue-50 rounded\">\n                      <div className=\"text-xl font-bold text-blue-600\">{activityStats.activeActivities}</div>\n                      <div className=\"text-xs text-gray-600\">Activas</div>\n                    </div>\n                    <div className=\"p-3 bg-red-50 rounded\">\n                      <div className=\"text-xl font-bold text-red-600\">{activityStats.overdueActivities}</div>\n                      <div className=\"text-xs text-gray-600\">Vencidas</div>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Tipos de Actividades</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {activityStats.typeDistribution.map((item) => (\n                    <div key={item.type} className=\"flex justify-between items-center\">\n                      <span className=\"text-sm\">{item.type}</span>\n                      <Badge variant=\"outline\">{item.count}</Badge>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Vista de Comunicación */}\n        <TabsContent value=\"communication\" className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"text-center\">\n                  <MessageSquare className=\"h-8 w-8 text-blue-600 mx-auto mb-2\" />\n                  <div className=\"text-2xl font-bold text-blue-600\">{communicationStats.totalMessages}</div>\n                  <div className=\"text-sm text-gray-600\">Total Mensajes</div>\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"text-center\">\n                  <Eye className=\"h-8 w-8 text-green-600 mx-auto mb-2\" />\n                  <div className=\"text-2xl font-bold text-green-600\">{communicationStats.readRate.toFixed(1)}%</div>\n                  <div className=\"text-sm text-gray-600\">Tasa de Lectura</div>\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"text-center\">\n                  <AlertTriangle className=\"h-8 w-8 text-red-600 mx-auto mb-2\" />\n                  <div className=\"text-2xl font-bold text-red-600\">{communicationStats.highPriorityMessages}</div>\n                  <div className=\"text-sm text-gray-600\">Alta Prioridad</div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n};\n\nexport default StatisticsPanel;"
